function startup(){that=this,that.token="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",L.mapbox.accessToken="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg";var e=L.mapbox.map("map").setView([34.86394,-111.76486],14).addControl(L.mapbox.shareControl()).addControl(L.mapbox.geocoderControl("mapbox.places"));that.map=e;var t,o=new Date;t=o.toString("dddd, MMMM dd, yyyy h:mm tt"),that.gotoloc=[],that.loader=document.getElementById("loader");var a=L.mapbox.featureLayer("sedonachamber.pmj9fija").addTo(e);a.on("mouseover",function(e){e.layer.openPopup(),"Point"==e.layer.feature.geometry.type&&(that.gotoloc=[e.layer.feature.geometry.coordinates[1],e.layer.feature.geometry.coordinates[0]]),$("#direc").on("click",function(e){e.preventDefault(),that.loader.className="",that.map.stopLocate(),that.map.locate()})}),a.on("click",function(e){e.layer.openPopup(),"Point"==e.layer.feature.geometry.type&&(that.gotoloc=[e.layer.feature.geometry.coordinates[1],e.layer.feature.geometry.coordinates[0]]),$("#direc").on("click",function(e){e.preventDefault(),that.loader.className="",that.map.stopLocate(),that.map.locate()}),ga("send","event","marker","click",e.layer.feature.properties.title)}),(bowser.android||bowser.ios)&&e.on("popupopen",function(t){var o=e.project(t.popup._latlng);o.y-=t.popup._container.clientHeight/2-100,e.panTo(e.unproject(o),{animate:!0})});var r=L.icon({iconUrl:"app/css/ripple.gif",iconAnchor:[10,10]}),i=L.control.locate({follow:!0,keepCurrentZoomLevel:!1,locateOptions:{maxZoom:16},metric:!1,showPopup:!0,markerClass:L.marker,markerStyle:{icon:r},onLocationError:function(e){vex.dialog.buttons.YES.text="OK";var t="";bowser.msie?t="<a target='_blank' style='color:#7A1800' href='http://windows.microsoft.com/en-us/internet-explorer/ie-security-privacy-settings#ie=ie-11'>How To </a>":bowser.chrome?t="<a target='_blank' style='color:#7A1800' href='https://support.google.com/chrome/answer/142065?hl=en'>How To </a>":bowser.firefox?t="<a target='_blank' style='color:#7A1800' href='https://support.mozilla.org/en-US/kb/improve-mozilla-location-services-turning-location'>How To </a>":bowser.android?t="<a target='_blank' style='color:#7A1800' href='https://support.scruff.com/hc/en-us/articles/202623634-How-do-I-enable-location-services-on-my-Android-'>How To </a>":bowser.ios&&(t="<a target='_blank' style='color:#7A1800' href='https://support.apple.com/en-us/HT203033'>How To </a>"),vex.dialog.alert({message:"Please Enable Your Location to find best directions from where you are.<br><br>"+t}),that.loader.className="hide"}}).addTo(e);o.getHours()>19||o.getHours()<7?L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets",{maxZoom:20}),Imagery:L.mapbox.tileLayer("mapbox.satellite",{maxZoom:20}),"Simple Streets":L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2opt8d00b9abnq6trki27e/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Outside:L.mapbox.tileLayer("mapbox.run-bike-hike"),Sedona:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin7oyyjz000waamcx7v412nr/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Red:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2kt8ku001sb4mawvdvwjxf/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Light:L.mapbox.tileLayer("mapbox.light"),Dark:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin961o3z00epcxnhaxgzwdb6/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}).addTo(e)},{}).addTo(e):L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets",{maxZoom:20}),Imagery:L.mapbox.tileLayer("mapbox.satellite",{maxZoom:20}),"Simple Streets":L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2opt8d00b9abnq6trki27e/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Outside:L.mapbox.tileLayer("mapbox.run-bike-hike"),Sedona:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin7oyyjz000waamcx7v412nr/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Red:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2kt8ku001sb4mawvdvwjxf/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}).addTo(e),Light:L.mapbox.tileLayer("mapbox.light"),Dark:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin961o3z00epcxnhaxgzwdb6/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20})},{}).addTo(e),that.loader.className="hide",e.on("locationfound",function(e){({type:"Feature",properties:{"marker-color":"#f00","marker-size":"small"},geometry:{type:"Point",coordinates:[e.longitude,e.latitude]}});if(0==that.gotoloc.length){var t=a.getGeoJSON(),o={};o.type="FeatureCollection",o.features=[];for(var r=0;r<t.features.length;r++)"Point"==t.features[r].geometry.type&&"bus"!=t.features[r].properties["marker-symbol"]&&"parking"!=t.features[r].properties["marker-symbol"]&&o.features.push(t.features[r]);var i=L.geoJson(o),s=L.GeometryUtil.closestLayer(that.map,i,e.latlng);bowser.android||bowser.ios||a.eachLayer(function(e){e.feature.properties.title===s.layer.feature.properties.title&&e.openPopup()}),that.map.setView(e.latlng,16),vex.dialog.buttons.YES.text="Get Directions",vex.dialog.alert({message:"You are here!<br><br><i>"+s.layer.feature.properties.title+"</i> is closest to you.<br>",callback:function(t){var o=[s.layer.feature.geometry.coordinates[1],s.layer.feature.geometry.coordinates[0]];that.loader.className="",that.getdirections(e.latlng,o)}})}else"[object Array]"===Object.prototype.toString.call(that.gotoloc[0])?that.getdirections(e.latlng,that.gotoloc[0]):that.getdirections(e.latlng,that.gotoloc);that.map.stopLocate()});var s=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){var t=L.DomUtil.create("div","img-control");return t}});e.addControl(new s),$(".img-control").click(function(){window.open("http://visitsedona.com/","_blank")}),vex.dialog.buttons.YES.text="Start Here",vex.dialog.buttons.NO.text="Browse Map",5==o.getDay()&&o.getDate()<7?t+='<br><br><a target="_blank" style="color:#7A1800" href="http://sedonagalleryassociation.com/?page_id=236">First Friday Art Walk. Click here for more information.</a></i>':4==o.getDay()&&o.getDate()<7?t+='<br><br><a target="_blank" style="color:#7A1800" href="http://sedonagalleryassociation.com/?page_id=236">First Friday Art Walk is tomorrow. Click here for more information.</a></i>':(o.getHours()>18||o.getHours()<8)&&(t+="<br><br><i>Galleries may be closed in the evening.</i>"),vex.dialog.confirm({message:"Welcome to the Sedona Art Walk Map!<br><br><a target='_blank' href='http://www.sedonachamber.com/'><img src='assets/red_sedona.jpg' style='padding-bottom:20px !important;padding-right:32px !important;'></></a><a target='_blank' href='http://sedonagalleryassociation.com/'><img src='assets/sga-logo-web.jpg' style=''></></a><br><br>"+t,callback:function(e){1==e&&i.start()}})}function getdirections(e,t){that=this,that.directionlayer&&that.map.removeLayer(that.directionlayer),that.to&&that.map.removeLayer(that.to),that.from&&that.map.removeLayer(that.from),that.to=L.circle(t,26,{color:"#fff",fillColor:"#9E2C2E",fillOpacity:.7}).addTo(map),that.from=L.circle(e,26,{color:"#fff",fillColor:"#A1D490",fillOpacity:.7}).addTo(map).bringToFront();var o="https://api.tiles.mapbox.com/v4/directions/mapbox.cycling/"+e.lng+","+e.lat+";"+t[1]+","+t[0]+".json?instructions=json&geometry=line&access_token="+that.token;$.get(o,function(e){if(e.routes.length>0){var t={};t.geometry=e.routes[0].geometry,t.type="Feature",t.properties={};var o="<i>Walking Time: "+Number(e.routes[0].duration/19).toPrecision(3)+" minutes<br><br>Walking Distance: "+Number(621371e-9*e.routes[0].distance).toPrecision(2)+" miles",a={color:"#61C5BE",weight:5,dashArray:"5,10",opacity:.9};that.directionlayer=L.geoJson(t,a).bindPopup(o).addTo(that.map);var r=that.directionlayer.getBounds();bowser.android||bowser.ios?(that.map.fitBounds(r,{padding:[73,73]}),that.directionlayer.eachLayer(function(e){e.openPopup()})):(that.map.fitBounds(r,{padding:[15,15]}),that.directionlayer.eachLayer(function(e){e.openPopup()}))}else vex.dialog.alert({message:"No Current Directions, please try again."});that.gotoloc=[],that.loader.className="hide"})}